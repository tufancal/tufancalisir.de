---
import { storyblokEditable, type SbBlokData } from "@storyblok/astro";
import type { Link } from "@/.storyblok/types/285719928053161/storyblok-components";

interface Props {
  blok: Link;
}

const { blok } = Astro.props;

const variant = blok.variant || "primary";
const size = blok.size || "md";

const buttonClasses = [
  "btn",
  variant ? `btn-${variant}` : "",
  size && size !== "md" ? `btn-${size}` : "",
]
  .filter(Boolean)
  .join(" ");

const getHref = () => {
  if (blok.url.linktype === "email") {
    return `mailto:${blok.url.email}`;
  }
  if (blok.url.linktype === "story") {
    return `/${blok.url.cached_url}${blok.url.anchor ? `#${blok.url.anchor}` : ""}`;
  }
  return `${blok.url.url}${blok.url.anchor ? `#${blok.url.anchor}` : ""}`;
};

const href = getHref();

const getTarget = () => {
  if (blok.url.target) return blok.url.target;
  if (blok.url.linktype === "story") return "_self";
  if (blok.url.linktype === "email") return "_self";
  return "_blank";
};

const target = getTarget();
const rel = target === "_blank" ? "noopener noreferrer" : undefined;
---

<a
  {...storyblokEditable(blok as SbBlokData)}
  href={href}
  target={target}
  rel={rel}
  class={buttonClasses}
  data-astro-reload={blok.url.anchor ? true : undefined}
>
  {blok.text}
</a>
